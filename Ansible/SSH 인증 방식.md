# SSH



### ğŸ“ŒINDEX

- [SSH íŒŒì¼](ssh-íŒŒì¼)
- [íŒ¨ìŠ¤ì›Œë“œ ê¸°ë°˜ SSH ì¸ì¦](#íŒ¨ìŠ¤ì›Œë“œ-ê¸°ë°˜-ssh-ì¸ì¦)
- [í‚¤ ê¸°ë°˜ SSH ì¸ì¦](#í‚¤-ê¸°ë°˜-ssh-ì¸ì¦)
- [SSH í‚¤ ìƒì„±](#ssh-í‚¤-ìƒì„±)
- [SSH í‚¤ ë¯¸ë¦¬ë°›ê¸°](#ssh-í‚¤-ë¯¸ë¦¬-ë°›ê¸°)
- [ì„œë²„ì— í‚¤ ë“±ë¡](#ì„œë²„ì—-í‚¤-ë“±ë¡)
- [SSH ì ‘ì†](#ssh-ì ‘ì†)

<br>

<br>

## SSH íŒŒì¼

**/etc/ssh/<Key_Pair>**

- ì„œë²„ì˜ í‚¤ ìŒ : publicí‚¤, privateí‚¤



**/etc/ssh/config_ssh** 

- ssh ì„œë¹„ìŠ¤ ì„¤ì •íŒŒì¼(í´ë¼ì´ì–¸íŠ¸)



**/etc/ssh/config_sshd** 

- sshd ì„œë¹„ìŠ¤ ì„¤ì •íŒŒì¼(ì„œë²„)
- íŒ¨ìŠ¤ì›Œë“œ ì¸ì¦ë°©ì‹ ë¹„í™œì„±í™”ê°€ default 

```shell
PasswordAuthentication no
```

- í‚¤ ê¸°ë°˜ ì¸ì¦ë°©ì‹ì€ í™œì„±í™”ê°€ default

```shell
GSSAPIAuthentication yes
```



**~/.ssh/<Key_Pair>**

- Client(ê³„ì •)ì˜ í‚¤ ìŒ



**~/.ssh/known_hosts**

- ì ‘ì†í–ˆë˜ í˜¸ìŠ¤íŠ¸ë¥¼ ê¸°ë¡(í•‘ê±°í”„ë¦°íŠ¸)
- í•œë²ˆ ê¸°ë¡ë˜ê³  ë‚˜ë©´ ì´í›„ ì ‘ì†í•  ë•Œ ë¬¼ì–´ë³´ì§€ ì•ŠìŒ
- **ê³„ì •ì„ ë°”ê¿”ì„œ ì ‘ì†í•˜ë©´ ë‹¤ì‹œ ë¬¼ì–´ë´„** -> í™ˆ ë””ë ‰í† ë¦¬ê°€ ë°”ë€Œê¸° ë•Œë¬¸



**~/.ssh/authorized_keys**

- ìƒëŒ€ë°©ì˜ ê³µê°œí‚¤ë¥¼ ì €ì¥



**~/.ssh/config**

- ssh ë¡œê·¸ì¸ ì‹œ ì˜µì…˜ì„ ì‚¬ì „ ì„¸íŒ… 
- ë“±ë¡í•´ë†“ìœ¼ë©´ windowì—ì„œ `ssh` ëª…ë ¹ì„ í†µí•´ ë§¤ìš° ê°„í¸í•˜ê²Œ ì ‘ì†
- ì˜ˆì‹œ

```shell
Host controller
    HostName 192.168.100.10
    User vagrant
    IdentityFile C:\Users\Playdata\vagrant\ansible\.vagrant\machines\controller\virtualbox\private_key

Host node1
    HostName 192.168.100.11
    User vagrant
    IdentityFile C:\Users\Playdata\vagrant\ansible\.vagrant\machines\node1\virtualbox\private_key

Host node2
    HostName 192.168.100.12
    User vagrant
    IdentityFile C:\Users\Playdata\vagrant\ansible\.vagrant\machines\node2\virtualbox\private_key
```

```shell
ssh controller
```

```shell
ssh node1
```

```shell
ssh node2
```



- íŒŒì¼ ìˆ˜ì • í›„ì—ëŠ” ë³€ê²½ì‚¬í•­ì´ ë°˜ì˜ë˜ë„ë¡ sshd ì„œë¹„ìŠ¤ ì¬ì‹œì‘

```shell
sudo systemctl restart sshd
```



<br>
<br>

## íŒ¨ìŠ¤ì›Œë“œ ê¸°ë°˜ SSH ì¸ì¦

A(Client) ---SSH---> B(Server)



1. AëŠ” Bì˜ ê³µê°œí‚¤ ìˆ˜ë ¹
   - `/etc/ssh/ssh_host_<Algorithm>.pub`
   - Algoritm
     - RSA
     - DSA
     - ECDSA
2. (B ì‹œìŠ¤í…œ ìµœì´ˆ ì ‘ì† ì‹œ) A ì‹œìŠ¤í…œ ì‚¬ìš©ìì—ê²Œ Bì˜ ê³µê°œí‚¤(ì§€ë¬¸)ì´ ë§ëŠ”ì§€ í™•ì¸
3. Aì˜ `~/.ssh/known_hosts`ì— Bì˜ ê³µê°œí‚¤ ë“±ë¡
4. ID/PW ì¸ì¦

<br>

<br>

## í‚¤ ê¸°ë°˜ SSH ì¸ì¦

A(Client) ---SSH---> B(Server)



1. Aì—ì„œ (ì¸ì¦ìš©) í‚¤ ìŒ ìƒì„± 
   - `ssh-keygen` 
     - `~/.ssh/id_rsa`: ê°œì¸í‚¤
     - `~/.ssh/id_rsa.pub`: ê³µê°œí‚¤

2. Bì— Aì˜ ê³µê°œí‚¤ë¥¼ ë“±ë¡
   - Bì˜ `~/.ssh/authorized_keys`ì— Aì˜ ê³µê°œí‚¤ ë“±ë¡
   - EC2 ì¸ìŠ¤í„´ìŠ¤ : Aì—ì„œ ì§€ì •í•œ Aì˜ ê³µê°œí‚¤ ë“±ë¡
   - BM/VM : `ssh-copy-id` ëª…ë ¹ì„ í†µí•´ ê³µê°œí‚¤ ë³µì‚¬
     - Bì— íŒ¨ìŠ¤ì›Œë“œ ì¸ì¦ë°©ì‹ì´ í™œì„±í™”ë˜ì–´ìˆì–´ì•¼í•¨

3. (B ì‹œìŠ¤í…œì— ìµœì´ˆ ì ‘ì†ì‹œ) A ì‹œìŠ¤í…œì˜ ì‚¬ìš©ìì—ê²Œ Bì˜ ê³µê°œí‚¤(ì§€ë¬¸) ë§ëŠ”ì§€ í™•ì¸
4. Aì˜ `~/.ssh/known_hosts` íŒŒì¼ì— Bì˜ ê³µê°œí‚¤ ë“±ë¡
   - Bì˜ IP/Domain
   - Bì˜ ê³µê°œí‚¤
5. Aì˜ ê°œì¸í‚¤ë¡œ ì¸ì¦



**ê¸°ë³¸ ë¡œê·¸ì¸ ì‚¬ìš©ì**

- Amazon Linux: ec2-user
- Ubuntu: ubuntu
- Debian: debian
- Centos: centos
- RHEL: cloud-user
- vagrant: vagrant
- ...

<br>

<br>

## SSH í‚¤ ìƒì„±

- **`ssh-keygen [ì˜µì…˜]`**

- **ssh keyë¥¼ ìƒì„±, ê´€ë¦¬ ë° ë³€ê²½í•˜ëŠ” ëª…ë ¹ì–´**
- private í‚¤ëŠ” defaultë¡œ ``~/.ssh/id_rsa` ìƒì„±
  - public í‚¤ëŠ” ê°™ì€ ìœ„ì¹˜ì— id_rsa.pubë¡œ ìƒì„±
- ì˜µì…˜ì´ ì—†ìœ¼ë©´ í‚¤ë¥¼ ìƒì„±
  - ``~/.ssh/id_<Algorithm>`` í‚¤ ìƒì„±
- ì˜µì…˜
  - `-t` : (type) ì•Œê³ ë¦¬ì¦˜ì„ ì§€ì •
  - `-f` : (file) í‚¤ íŒŒì¼ì˜ íŒŒì¼ ì´ë¦„ ì§€ì •
  - `-l` : (list) ì§€ì •í•œ ê³µê°œ í‚¤ íŒŒì¼ì˜ ì§€ë¬¸ì„ í‘œì‹œ
  - `-b` : (bit) í‚¤ì˜ í¬ê¸° ì§€ì •
    - default : 2048
    - í¬ê¸°ë¥¼ ëŠ˜ë¦´ ìˆ˜ë¡ ë³´ì•ˆì´ ê°•í™”ë¨

- ìƒì„± í›„ì— `passphrase`ë¥¼ ì„¤ì •í•˜ë¼ê³ í•¨
  - ë³´ì•ˆì„ ìœ„í•´ì„œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ



ì˜ˆì‹œ

- ecdsa ì•Œê³ ë¦¬ì¦˜ì˜ í‚¤ìŒ ìƒì„±

```shell
ssh-keygen -t ecdsa
```

- **(ì„œë²„ì˜)`/etc/ssh/ssh_host_ecdsa_key.pub` ê³µê°œí‚¤ ì§€ë¬¸ í™•ì¸**â­
  - ë¯¸ë¦¬ ì¤€ë¹„ëœ ì„œë²„ì˜ ê²½ìš° ì´ë ‡ê²Œ ì§€ë¬¸ì„ í™•ì¸í•˜ëŠ” ê²ƒì´ best
  - But, EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ê²½ìš° ë§Œë“¤ì–´ì§ˆ ë•Œ keyê°€ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ë¯¸ë¦¬ í™•ì¸í•  ë°©ë²•ì´ ì—†ìŒ

```shell
ssh-keygen -l -f /etc/ssh/ssh_host_ecdsa_key.pub
```

<br>

<br>

## SSH í‚¤ ë¯¸ë¦¬ ë°›ê¸°

- **`ssh-keyscan [ì˜µì…˜] [ëŒ€ìƒIP]`**
- **ëŒ€ìƒì˜ ê³µê°œí‚¤ë¥¼ ë¯¸ë¦¬ ë°›ì•„ë³¼ ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´**
- ë§¹ì  : ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì „ë‹¬ë°›ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì¤‘ê°„ì— í•´ì»¤ê°€ ê°€ë¡œì±„ì„œ ì˜ëª»ë  ì •ë³´ë¥¼ ì¤„ ìˆ˜ë„ ìˆìŒ

- ì˜µì…˜
  - `-t` : ì•Œê³ ë¦¬ì¦˜ íƒ€ì… ì§€ì •í•´ì„œ í™•ì¸



ì˜ˆì‹œ

- ì„œë²„(IP)ì˜ rsa ì•Œê³ ë¦¬ì¦˜ì˜ ê³µê°œí‚¤ í™•ì¸

```shell
ssh-keyscan -t rsa 192.168.100.11
```

- íŒŒì´í”„ë¼ì¸(|)ì„ í™œìš©í•˜ì—¬, ì„œë²„(IP)ì˜ **í•‘ì»¤í”„ë¦°íŠ¸(ì§€ë¬¸) ë°”ë¡œ í™•ì¸**â­
  - íŒŒì´í”„ë¼ì¸ ì• ëª…ë ¹ì˜ ì¶œë ¥ì´ íŒŒì´í”„ë¼ì¸ ë’¤ '`-`'ë¡œ ë“¤ì–´ê°

```shell
ssh-keyscan -t ecdsa 192.168.100.11 | ssh-keygen -l -f -
```

- **ë¯¸ë¦¬ ì„œë²„ì˜ ê³µê°œí‚¤ `known_hosts`ì— ë¯¸ë¦¬ ë“±ë¡í•˜ê¸°**â­
  - í•‘ê±°í”„ë¦°íŠ¸ë¥¼ ë¬¼ì–´ë³´ì§€ ì•ŠìŒ
  - but, ë“±ë¡í•´ë„ ì„œë²„ê°€ ì•”í˜¸ì¸ì¦(`sshd_config`)ì„ í™œì„±í™”í•´ë‘¬ì•¼ ì ‘ì†ë¨
    - í‚¤ë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•´ì„œëŠ” ì•”í˜¸ ì¸ì¦ì´ ê°€ëŠ¥í•´ì•¼í•¨

```shell
ssh-keyscan -t ecdsa 192.168.100.11 >> ~/.ssh/Known_hosts
```

```shell
ssh-keyscan -t ecdsa 192.168.100.12 >> ~/.ssh/known_hosts
```

<br>

<br>

## ì„œë²„ì— í‚¤ ë“±ë¡

- **`ssh-copy-id [ëŒ€ìƒ IP]`**
- í´ë¼ì´ì–¸íŠ¸(Client)ì˜ ê³µê°œí‚¤ê°€ ì„œë²„ì˜ `~/.ssh/authorized_keys`ì— ë“±ë¡ë¨
- ë“±ë¡ í›„ì—ëŠ” íŒ¨ìŠ¤ì›Œë“œë¥¼ ë¬¼ì–´ë³´ì§€ ì•ŠìŒ

```shell
ssh-copy-id 192.168.100.11
```

- ê³„ì •ì„ ì§€ì •í•´ì£¼ì§€ ì•Šìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ì˜ ê³„ì •ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- ëª…í™•í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œëŠ” ê³„ì •ì„ ì§€ì •í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ

```shell
ssh-copy-id vagrant@192.168.100.11
```



<br>

<br>

## SSH ì ‘ì†

- `ssh`ë¡œ ì ‘ì†í•  ë•Œ ê³„ì •ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´, í˜„ì¬ í´ë¼ì´ì–¸íŠ¸ì˜ ê³„ì •ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- ì„œë²„ì— ì ‘ì†í•  ë•Œ, ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë¬¼ì–´ë´„
- ê³„ì •ì„ ë°”ê¿”ì„œ ì ‘ì†í•˜ë©´ í•‘ê±°í”„ë¦°íŠ¸ ë‹¤ì‹œ ë¬¼ì–´ë´„
  - í™ˆ ë””ë ‰í† ë¦¬ê°€ ë°”ë€Œê¸° ë•Œë¬¸



#### Windows -> Vagrant SSH ì ‘ê·¼

- vagrantë¥¼ ì´ìš©í•˜ë©´ ìë™ìœ¼ë¡œ í‚¤ ê¸°ë°˜ ì¸ì¦
  - .vagrant íŒŒì¼ì€ ì ˆëŒ€ ìˆ˜ë™ìœ¼ë¡œ ë³€ê²½,ì¡°ì‘,ì‚­ì œí•˜ë©´ ì•ˆë¨
  - í‚¤ ìœ„ì¹˜(í´ë¼ì´ì–¸íŠ¸ì˜ í‚¤) : `.vagrant/machines/[vmëª…]/virtualbox/private_key`
  - ì•„ë˜ ë‘ê°œì˜ ëª…ë ¹ì–´ëŠ” ë™ì¼í•œ ëª…ë ¹ì–´ : vagrantê°€ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•´ì£¼ëŠ” ê²ƒ

```
vagrant ssh controller 
```

```shell
ssh -i .\vagrant\machines\controller\virtualbox\private_key vagrant@192.168.100.10
```



ì°¸ê³ ) ë§Œì•½ ssh í‚¤ê°€ ë…¸ì¶œ, ìœ ì¶œëœ ê²½ìš° ì„œë²„ìª½ í‚¤ íŒŒì¼ì„ ëª¨ë‘ ì§€ìš°ê³  ì¬ë¶€íŒ…í•˜ë©´ í‚¤ íŒŒì¼ë“¤ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì§

<br>

<br>

